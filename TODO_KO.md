# 쿠폰 시스템 구현 할일 목록

## 프로젝트 개요
대규모 동시성 환경을 위한 실시간 동기 쿠폰 발급 시스템 구현 - 100만 명의 잠재적 클라이언트가 1,000개의 한정된 쿠폰을 두고 경쟁하며 즉각적인 응답을 받는 시스템

## 인프라 및 트래픽 관리
- [ ] **1. API 게이트웨이 설정** - 토큰 버킷 알고리즘을 사용한 속도 제한 및 스로틀링 구성
- [ ] **2. 로드 밸런서 구현** - 애플리케이션 서버의 수평적 확장을 위한 구성
- [ ] **3. Redis 클러스터 설계** - 고가용성을 위한 다중 AZ 배포 설정

## 핵심 로직 및 데이터 모델
- [ ] **4. Redis 재고 관리** - 쿠폰 재고를 위한 데이터 모델 생성 (`coupon:event_id:stock`)
- [ ] **5. Redis 참여자 추적** - 참여자를 위한 데이터 모델 생성 (`coupon:event_id:participants`)
- [ ] **6. Lua 스크립트 개발** - 경쟁 상태 방지를 위한 원자적 쿠폰 발급 스크립트 개발
- [ ] **7. Python 애플리케이션 서버** - Docker 컨테이너화로 구축
- [ ] **8. 쿠폰 API 엔드포인트** - FastAPI/Flask를 사용한 동기식 쿠폰 발급 API 구현

## 영속성 및 메시징
- [ ] **9. 메시지 큐 시스템** - Apache Kafka 또는 AWS SQS 설정
- [ ] **10. 비동기 이벤트 발행** - 메시지 큐로의 이벤트 발행 구현
- [ ] **11. 데이터베이스 스키마** - coupons 및 coupon_issuances 테이블 설계
- [ ] **12. 컨슈머 서비스** - 큐에서 메시지를 처리하는 Docker를 사용한 Python 서비스 생성
- [ ] **13. 멱등적 쓰기** - UNIQUE 제약 조건을 사용한 데이터베이스 쓰기 구현

## 안정성 및 오류 처리
- [ ] **14. 데드 레터 큐** - 실패한 메시지 처리를 위한 DLQ 설정
- [ ] **15. 재시도 로직** - 컨슈머 서비스를 위한 지수 백오프 구현
- [ ] **16. 데이터 무결성** - 검증 및 정합성 확인 프로세스 생성
- [ ] **17. 모니터링** - 큐 깊이, DLQ, Redis 메트릭에 대한 알림 설정
- [ ] **18. 클라이언트 오류 처리** - 429/503 오류에 대한 우아한 실패 처리 구현

## 테스트 및 운영
- [ ] **19. 부하 테스트** - 포괄적인 성능 튜닝 수행
- [x] **20. 문서 업데이트** - 프로젝트 아키텍처로 CLAUDE.md 파일 업데이트
- [x] **21. 할일 파일 생성** - 프로젝트 추적을 위한 할일 목록 파일 생성
- [ ] **22. Docker 구성** - Docker 구성 파일 생성 (Dockerfile, docker-compose.yml)
- [ ] **23. Python 프로젝트 설정** - requirements.txt와 함께 Python 프로젝트 구조 설정
- [ ] **24. 문서 업데이트** - Docker와 Python 요구사항을 반영하여 문서 업데이트

## 아키텍처 구성 요소 참조

### 기술 스택
- **API 게이트웨이**: Amazon API Gateway, NGINX Plus, Apache APISIX
- **로드 밸런서**: AWS Application Load Balancer, HAProxy  
- **애플리케이션 서버**: EKS/ECS 상의 Docker를 사용한 Python
- **캐시**: Redis Cluster
- **메시지 큐**: Apache Kafka, AWS SQS
- **데이터베이스**: 복제 기능이 있는 PostgreSQL, MySQL
- **컨슈머**: Docker 컨테이너를 사용한 Python (Kubernetes Pods, ECS Tasks)

### 핵심 설계 원칙
1. **공격적인 엣지 트래픽 관리** - 핵심 서비스에 도달하기 전 트래픽 제어
2. **원자적 인메모리 연산** - 잠금 없는 동시성을 위한 Redis + Lua 스크립팅
3. **분리된 영속성 처리** - 메시지 큐를 사용한 동기 응답과 DB 쓰기 분리
4. **복원력 및 고가용성** - 다층 장애 허용성 및 복구

---

**상태 범례:**
- [ ] 대기 중
- [x] 완료
- [~] 진행 중

## 개발 요구사항

### Python & Docker 스택
- **Python 버전**: 3.9 이상
- **웹 프레임워크**: FastAPI (권장) 또는 Flask
- **컨테이너화**: 멀티 스테이지 빌드를 사용한 Docker
- **오케스트레이션**: Docker Compose (로컬), Kubernetes/ECS (프로덕션)
- **주요 Python 라이브러리**: redis-py, asyncio, pydantic, sqlalchemy, kafka-python

**최종 업데이트:** 2025-08-19