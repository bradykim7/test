# 쿠폰 시스템 구현 할일 목록

## 프로젝트 개요
대규모 동시성 환경을 위한 실시간 동기 쿠폰 발급 시스템 구현 - 100만 명의 잠재적 클라이언트가 1,000개의 한정된 쿠폰을 두고 경쟁하며 즉각적인 응답을 받는 시스템

## 인프라 및 트래픽 관리
- [x] **1. API 게이트웨이 설정** - 토큰 버킷 알고리즘을 사용한 NGINX 속도 제한 및 스로틀링 구성
- [x] **2. 로드 밸런서 구현** - NGINX 업스트림을 사용한 수평적 확장 구성 구현
- [x] **3. Redis 클러스터 설계** - 고가용성을 위한 6개 노드 클러스터(3개 마스터 + 3개 슬레이브) 설계 및 구현

## 핵심 로직 및 데이터 모델
- [x] **4. Redis 캐시 관리** - TTL을 사용한 핫 데이터를 위한 캐시 모델 생성 (`coupon:event_id:stock`)
- [x] **5. MySQL 데이터베이스 스키마** - 쿠폰, 이벤트, 사용자 데이터를 위한 영구 테이블 설계
- [x] **6. Lua 스크립트 개발** - 경쟁 상태 방지를 위한 원자적 쿠폰 발급 개발
- [x] **7. Python 애플리케이션 서버** - Redis 클러스터 및 MySQL 통합으로 FastAPI 구축
- [x] **8. 쿠폰 API 엔드포인트** - 캐시 우선 접근 방식으로 동기식 쿠폰 발급 API 구현

## 영속성 및 메시징
- [x] **9. Kafka 클러스터 설정** - 여러 브로커를 가진 Apache Kafka 클러스터 설정
- [x] **10. Kafka 이벤트 발행** - Kafka 토픽으로의 이벤트 발행 구현
- [x] **11. MySQL 데이터베이스 스키마** - 적절한 인덱싱을 가진 쿠폰, 이벤트, user_coupons 테이블 설계
- [x] **12. 컨슈머 서비스** - Kafka를 소비하고 MySQL에 쓰는 Python 서비스 생성
- [x] **13. 멱등적 데이터베이스 쓰기** - UNIQUE 제약 조건과 적절한 오류 처리로 구현

## 안정성 및 오류 처리
- [x] **14. Kafka 데드 레터 토픽** - 실패한 메시지 처리를 위한 DLT 설정
- [x] **15. 재시도 로직** - 컨슈머 서비스를 위한 지수 백오프 구현
- [ ] **16. 데이터 무결성** - Redis 캐시와 MySQL 간 검증 및 정합성 확인 생성
- [ ] **17. 모니터링** - Kafka 지연, Redis 클러스터 상태, MySQL 메트릭에 대한 알림 설정
- [ ] **18. 클라이언트 오류 처리** - 429/503 오류에 대한 우아한 실패 처리 구현

## 개발 및 운영
- [ ] **19. 부하 테스트** - 포괄적인 성능 튜닝 수행
- [x] **22. Docker 구성** - Docker 구성 파일 생성 (Dockerfile, docker-compose.yml)
- [x] **23. Python 프로젝트 설정** - requirements.txt와 함께 Python 프로젝트 구조 설정

## 아키텍처 구성 요소 참조

### 기술 스택
- **프로그래밍 언어**: Python 3.9+
- **웹 프레임워크**: FastAPI
- **캐시**: Redis 클러스터 (6개 노드: 3개 마스터 + 3개 슬레이브)
- **데이터베이스**: 복제 기능이 있는 MySQL/MariaDB
- **메시지 큐**: Apache Kafka 클러스터
- **컨테이너화**: 멀티 스테이지 빌드를 사용한 Docker
- **오케스트레이션**: Docker Compose (로컬 개발), Kubernetes/ECS (프로덕션)
- **Python 라이브러리**: redis-py-cluster, asyncio, pydantic, sqlalchemy, pymysql, kafka-python

### 핵심 설계 원칙
1. **공격적인 엣지 트래픽 관리** - 토큰 버킷 속도 제한을 사용한 API 게이트웨이를 통해 핵심 서비스에 도달하기 전 트래픽 제어
2. **원자적 인메모리 연산** - 경쟁 상태를 방지하는 잠금 없는 동시성 제어를 위한 Redis + Lua 스크립팅
3. **분리된 영속성 처리** - 성능을 위해 메시지 큐를 사용하여 동기 응답과 데이터베이스 쓰기 분리
4. **복원력 및 고가용성** - DLQ, 재시도 로직, 다중 AZ 배포를 통한 다층 장애 허용성

---

**상태 범례:**
- [ ] 대기 중
- [x] 완료
- [~] 진행 중

**최종 업데이트:** 2025-08-21