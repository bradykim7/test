# CLAUDE_KO.md

이 파일은 Claude Code (claude.ai/code)가 이 저장소에서 코드 작업을 할 때 한국어 가이드를 제공합니다.

## 프로젝트 개요

이 저장소는 대규모 동시성 환경을 위해 설계된 실시간 동기 쿠폰 발급 시스템을 구현합니다. 100만 명의 잠재적 클라이언트가 1,000개의 한정된 쿠폰을 두고 경쟁하며 즉각적인 성공/실패 응답을 받는 시스템입니다.

## 아키텍처 개요

시스템은 다음과 같은 핵심 구성 요소를 가진 하이브리드 동기/비동기 아키텍처를 사용합니다:

### 핵심 설계 원칙
1. **공격적인 엣지 트래픽 관리** - API 게이트웨이를 사용하여 핵심 서비스에 도달하기 전 트래픽 제어
2. **원자적 인메모리 연산** - 잠금 없는 동시성 제어를 위한 Redis + Lua 스크립팅
3. **분리된 영속성 처리** - 메시지 큐를 사용한 동기 응답과 데이터베이스 쓰기 분리
4. **복원력 및 고가용성** - 다층 장애 허용성 및 복구 메커니즘

### 시스템 구성 요소
- **API 게이트웨이**: 속도 제한 및 스로틀링 (Amazon API Gateway, NGINX Plus)
- **로드 밸런서**: 수평적 확장 (AWS ALB, HAProxy)
- **애플리케이션 서버**: Docker 컨테이너화된 Python (EKS/ECS 상의 FastAPI/Flask)
- **Redis 클러스터**: 다중 AZ 배포를 통한 원자적 쿠폰 연산
- **메시지 큐**: 비동기 영속성 (Apache Kafka, AWS SQS)
- **데이터베이스**: 최종 기록 저장소 (복제 기능이 있는 PostgreSQL/MySQL)
- **컨슈머 서비스**: Docker 컨테이너를 사용한 Python (Kubernetes Pods, ECS Tasks)

### 요청 흐름
1. 클라이언트 요청 → API 게이트웨이 (속도 제한) → 로드 밸런서 → 앱 서버
2. 앱 서버가 Redis 클러스터에서 원자적 Lua 스크립트 실행
3. 클라이언트에게 즉각적인 동기 응답 (성공/실패)
4. 성공 시: 메시지 큐에 이벤트 발행
5. 컨슈머 서비스가 큐 처리 → 데이터베이스에 쓰기
6. 데드 레터 큐가 실패한 메시지 처리

## 구현 작업

### 인프라 및 트래픽 관리
- [ ] **1. API 게이트웨이 설정** - 토큰 버킷 알고리즘을 사용한 속도 제한 및 스로틀링 구성
- [ ] **2. 로드 밸런서** - 수평적 확장을 위한 구성 구현
- [ ] **3. Redis 클러스터** - 고가용성을 위한 다중 AZ 배포 설계 및 구현

### 핵심 로직 및 데이터 모델
- [ ] **4. Redis 재고 관리** - 쿠폰 재고를 위한 데이터 모델 생성 (`coupon:event_id:stock`)
- [ ] **5. Redis 참여자 추적** - 참여자를 위한 데이터 모델 생성 (`coupon:event_id:participants`)
- [ ] **6. Lua 스크립트 개발** - 경쟁 상태 방지를 위한 원자적 쿠폰 발급 개발
- [ ] **7. Python 애플리케이션 서버** - Docker 컨테이너화로 구축
- [ ] **8. 쿠폰 API 엔드포인트** - FastAPI/Flask를 사용한 동기식 쿠폰 발급 API 구현

### 영속성 및 메시징
- [ ] **9. 메시지 큐 시스템** - Apache Kafka 또는 AWS SQS 설정
- [ ] **10. 비동기 이벤트 발행** - 메시지 큐로의 이벤트 발행 구현
- [ ] **11. 데이터베이스 스키마** - coupons 및 coupon_issuances 테이블 설계
- [ ] **12. 컨슈머 서비스** - 큐에서 메시지를 처리하는 Docker를 사용한 Python 서비스 생성
- [ ] **13. 멱등적 데이터베이스 쓰기** - UNIQUE 제약 조건으로 구현

### 안정성 및 오류 처리
- [ ] **14. 데드 레터 큐** - 실패한 메시지 처리를 위한 DLQ 설정
- [ ] **15. 재시도 로직** - 컨슈머 서비스를 위한 지수 백오프 구현
- [ ] **16. 데이터 무결성** - 검증 및 정합성 확인 프로세스 생성
- [ ] **17. 모니터링** - 큐 깊이, DLQ, Redis 메트릭에 대한 알림 설정
- [ ] **18. 클라이언트 오류 처리** - 429/503 오류에 대한 우아한 실패 처리 구현

### 개발 및 운영
- [ ] **19. 부하 테스트** - 포괄적인 성능 튜닝 수행
- [ ] **22. Docker 구성** - Docker 구성 파일 생성 (Dockerfile, docker-compose.yml)
- [ ] **23. Python 프로젝트 설정** - requirements.txt와 함께 Python 프로젝트 구조 설정

## 핵심 설계 원칙

1. **공격적인 엣지 트래픽 관리** - 토큰 버킷 속도 제한을 사용한 API 게이트웨이를 통해 핵심 서비스에 도달하기 전 트래픽 제어
2. **원자적 인메모리 연산** - 경쟁 상태를 방지하는 잠금 없는 동시성 제어를 위한 Redis + Lua 스크립팅
3. **분리된 영속성 처리** - 성능을 위해 메시지 큐를 사용하여 동기 응답과 데이터베이스 쓰기 분리
4. **복원력 및 고가용성** - DLQ, 재시도 로직, 다중 AZ 배포를 통한 다층 장애 허용성

## 주요 파일

- `report.txt` - 상세한 아키텍처 설계 문서 (한국어)
- `TODO.md` - 독립적인 영어 구현 작업 목록
- `TODO_KO.md` - 독립적인 한국어 구현 작업 목록  
- `CLAUDE.md` - 이 문서의 영어 버전

## 기술 스택 요구사항

- **프로그래밍 언어**: Python 3.9+
- **웹 프레임워크**: FastAPI (권장) 또는 Flask
- **컨테이너화**: 멀티 스테이지 빌드를 사용한 Docker
- **오케스트레이션**: 로컬 개발용 Docker Compose, 프로덕션용 Kubernetes/ECS
- **Python 라이브러리**: redis-py, asyncio, pydantic, sqlalchemy, kafka-python

## 커뮤니케이션 가이드라인

- 모든 상호작용에서 영어와 한국어 모두로 응답하기
- CLAUDE.md는 영어로 유지하고 CLAUDE_KO.md를 한국어 버전으로 관리하기
- CLAUDE.md를 업데이트할 때 CLAUDE_KO.md도 한국어 번역으로 자동 업데이트하기

## 참고사항

- 이것은 최소한의 콘텐츠를 가진 새로운 저장소입니다
- `.qodo` 디렉터리가 존재하지만 비어있습니다
- 저장소 이름을 기반으로 프로젝트 범위는 쿠폰 관련인 것으로 보입니다